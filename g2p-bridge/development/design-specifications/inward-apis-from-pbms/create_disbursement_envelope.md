---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# create\_disbursement\_envelope

| API Attributes |                                                                    |
| -------------- | ------------------------------------------------------------------ |
| Direction      | Inward                                                             |
| Invoked by     | PBMS                                                               |
| Mode           | Synchronous                                                        |
| Tables         | <p>disbursement_envelope<br>disbursement_envelope_batch_status</p> |

disbursement\_envelope represents a control object that **uniquely defines one instance of disbursement for one disbursement cycle for a benefit program**

A benefit program - in one disbursement cycle - will create exactly one disbursement envelope.

This envelope will represent the control object under which all individual disbursements will be made - for one benefit program - for one disbursement cycle.

The object (and corresponding persistent table) will have the following attributes

## Object Design

### disbursement\_envelope

| Attribute                    | Datatype                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| disbursement\_envelope\_id   | Uniquely Identifies the Disbursement Envelope. Primary Key of the Table                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| benefit\_program\_mnemonic   | The short code that uniquely identifies the benefit program that is creating this disbursement envelope                                                                                                                                                                                                                                                                                                                                                                                                             |
| disbursement\_frequency      | <p>ENUM - identifies the frequency with which disbursements are effected under this benefit program. Possible Values<br><br>Weekly<br>Fortnightly<br>Monthly<br>Bimonthly<br>Quarterly<br>SemiAnnually<br>Annually<br>OnDemand</p>                                                                                                                                                                                                                                                                                  |
| cycle\_code\_mnemonic        | <p>Identifies the particular frequency cycle under which this envelope is being created. <br><br>Examples - March-2024 or Q1-2024 or Week-1-Jan-2024 or 03-Jan-2024</p>                                                                                                                                                                                                                                                                                                                                             |
| number\_of\_beneficiaries    | Specifies the number of distinct beneficiaries that this envelope will serve                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| number\_of\_disbursements    | Specifies the number of discrete disbursements that this envelop will create. In ideal cases, this should equal to the number of beneficiaries, there might be instances where a beneficiary gets more than one disbursement in a single envelope.                                                                                                                                                                                                                                                                  |
| total\_disbursement\_amount  | The total of all individual disbursements. This is the control total for one "disbursement cycle - benefit program"                                                                                                                                                                                                                                                                                                                                                                                                 |
| disbursement\_currency\_code | <p>The ISO Currency code in which the disbursement is going to be effected.<br><br>This does not necessarily mean that the beneficiaries will be credited (or given cash) in this currency. This only represents the funding side.<br><br>If beneficiaries are credited in a different account, that currency conversion will happen in the Destination banks (which service the beneficiaries). This currency conversion is of no consequence to the PBMS/Funding Organization/Benefit Program Administration.</p> |
| disbursement\_schedule\_date | This is the date on which the Disbursement needs to be effected.                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| receipt\_time\_stamp         | The timestamp when the envelope was received and persisted by the G2P Bridge                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| cancellation\_status         | <p>Enum<br>NOT_CANCELLED<br>CANCELLED</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| cancellation\_time\_stamp    | The timestamp when the cancellation request was received                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

### **disbursement\_envelope\_batch\_status**

| Attribute                             | Datatype                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| disbursement\_envelope\_id            | Uniquely identifies the disbursement envelope. Primary Key                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| number\_of\_disbursements\_received   | <p>The PBMS will first create the disbursement envelope. After that, the PBMS will then dispatch (create) the individual disbursements under the envelope. Being a social benefit program, each envelop can potentially target a large population - running into hundreds of thousands (perhaps even millions). <br>The PBMS is expected to do this disbursement in batches. <br>This attribute - is the control - that keeps track of the number of disbursements that have actually been received by the G2P Bridge from the PBMS.<br><br>Once this number reaches the number specified by the <strong>disbursement_envelope.total_number_of_disbursements</strong>, the system will not accept any more disbursements from the upstream PBMS platform.</p> |
| total\_disbursement\_amount\_received | This represents the sum of individual disbursements received. Once this number matches the number specified in the envelope (control figure), the system will not accept any more disbursements from the upstream PBMS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| funds\_available\_with\_bank          | <p>Enum<br>PENDING_CHECK</p><p>FUNDS_NOT_AVAILABLE<br>FUNDS_AVAILABLE</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| funds\_available\_latest\_timestamp   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| funds\_available\_latest\_error\_code |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| funds\_available\_attempts            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| funds\_blocked\_with\_bank            | <p>Enum<br>PENDING_CHECK<br>FUNDS_BLOCK_SUCCESS<br>FUNDS_BLOCK_FAILURE<br><br>As and when PBMS ships the disbursements, this field will be updated to "Pending" - once all the disbursements are received (the received number of disbursements equal to the declared number of disbursements)<br><br>Pending -> Complete - This will be updated by a background job that creates "Hold Funds" with the Sponsor Bank.</p>                                                                                                                                                                                                                                                                                                                                     |
| funds\_blocked\_time\_stamp           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| funds\_blocked\_latest\_error\_code   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| funds\_blocked\_attempts              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| funds\_blocked\_reference\_number     | <p>This is the Amount Block (Funds Hold) Reference number - returned by the Sponsor Bank.<br>This Reference number uniquely identifies the Amount Block that has been placed against the Disbursement Envelope.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| id\_mapper\_resolution\_required      | <p>TRUE / FALSE<br>This value is taken from the helper table - benefit_program.id_mapper_resolution_required</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| number\_of\_disbursements\_shipped    | <p>The G2P Bridge will ship the disbursements to the Sponsor Bank in batches (Note that the volume of disbursements is expected to be in 100s of 1000s or perhaps even millions, batch processing will be necessary). <br>This attribute is updated as and when batches of disbursements are successfully shipped <br>After all disbursements are shipped, this number will equal to the envelope.number_of_disbursements</p>                                                                                                                                                                                                                                                                                                                                 |
| number\_of\_disbursements\_failed     | Updated by "failure" feedback from Sponsor Bank                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

### Business Logic

Will result in persistence of 1 record each in the tables - disbursement\_envelope and disbursement\_envelope\_batch\_status

### Validations & Exceptions

1. disbursement\_schedule\_date should be greater than today + disbursement\_sla\_days (configuration)
2. disbursement\_currency\_code should be equal to benefit\_program.disbursement\_currency\_code
3. disbursement\_envelope\_id should be unique
4. benefit\_program\_mnemonic should exist in benefit\_program
5. number\_of\_beneficiaries - valid non zero integer
6. number\_of\_disbursements - should be greater or equal to number\_of\_beneficiaries
7. total\_disbursement\_amount - valid non zero number









